---
// src/pages/entrenamiento/index.astro - VERSIÓN CORREGIDA
import { getCollection } from 'astro:content';
import CategoryLayout from '../../layouts/CategoryLayout.astro';

// ✅ USAR DATOS REALES DEL CMS
const todosLosArticulos = await getCollection('articulos');

// Filtrar artículos de entrenamiento
const articles = todosLosArticulos.filter(articulo => {
  const categoria = articulo.data.category;
  const etiquetas = articulo.data.tags || [];
  
  // Filtrar por categoría "entrenamiento" o etiquetas relacionadas
  return categoria === 'entrenamiento' || 
         etiquetas.includes('entrenamiento') ||
         etiquetas.includes('adiestramiento') ||
         etiquetas.includes('training');
});

// Obtener categorías reales
const todasLasCategorias = await getCollection('categorias');
const categoriaEntrenamiento = todasLasCategorias.find(cat => cat.slug === 'entrenamiento');

// Artículo destacado (el más reciente de entrenamiento)
const featuredArticle = articles
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())[0];

// Obtener etiquetas reales
const todasLasEtiquetas = await getCollection('etiquetas');
const popularTags = todasLasEtiquetas
  .filter(tag => tag.data.featured)
  .map(tag => tag.data.name);

const title = "Entrenamiento de Mascotas";
const description = categoriaEntrenamiento?.data.description || "Descubre técnicas efectivas y consejos de expertos para entrenar a tu perro o gato.";
const image = categoriaEntrenamiento?.data.image || "/images/categories/training-banner.jpg";

// Subcategorías dinámicas basadas en etiquetas
const subcategories = todasLasEtiquetas
  .filter(tag => {
    const relatedCategories = tag.data.categories || [];
    return relatedCategories.includes('entrenamiento');
  })
  .map(tag => tag.data.name);
---

<CategoryLayout
  title={title}
  description={description}
  image={image}
  category="entrenamiento"
  subcategories={subcategories}
  articles={articles}
  popularTags={popularTags}
  featuredArticle={featuredArticle}
/>