---
// src/pages/entrenamiento/index.astro - SOLO CMS CON AVATARES REALES
import { getCollection } from 'astro:content';
import CategoryLayout from '../../layouts/CategoryLayout.astro';

// ðŸ”§ FUNCIÃ“N DE AVATARES REALES
function getAuthorAvatar(authorName: string): string {
  const authorAvatars: Record<string, string> = {
    'Ana MarÃ­a Prieto': '/images/ana-p2.webp',
    'Manuel Alejandro Bedoya': '/images/manuel-p1.webp',
    'Equipo Editorial Balto': '/images/baltologo.svg',
    'Editor Balto': '/images/baltologo.svg'
  };
  
  return authorAvatars[authorName] || '/images/baltologo.svg';
}

// Obtener datos del CMS
const todosLosArticulos = await getCollection('articulos');
const todasLasCategorias = await getCollection('categorias');
const todasLasEtiquetas = await getCollection('etiquetas');

// Filtrar artÃ­culos de entrenamiento
const articles = todosLosArticulos
  .filter(articulo => {
    const categoria = articulo.data.category;
    const etiquetas = articulo.data.tags || [];
    
    return categoria === 'entrenamiento' || 
           etiquetas.includes('entrenamiento') ||
           etiquetas.includes('training') ||
           etiquetas.includes('adiestramiento') ||
           etiquetas.includes('obediencia') ||
           etiquetas.includes('comandos') ||
           etiquetas.includes('cachorros');
  })
  .map(articulo => ({
    id: articulo.slug,
    title: articulo.data.title,
    excerpt: articulo.data.description || articulo.data.excerpt,
    image: articulo.data.image || '/images/articles/default.jpg',
    date: articulo.data.date.toISOString().split('T')[0],
    author: {
      name: articulo.data.author || 'Editor Balto',
      avatar: getAuthorAvatar(articulo.data.author || 'Editor Balto')
    },
    readingTime: articulo.data.readingTime || 5,
    categories: [articulo.data.category, ...(articulo.data.tags || [])].filter(Boolean)
  }));

// Obtener datos de categorÃ­a del CMS
const categoriaEntrenamiento = todasLasCategorias.find(cat => cat.slug === 'entrenamiento');

// ArtÃ­culo destacado (el mÃ¡s reciente)
const featuredArticle = articles
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())[0];

// Obtener etiquetas relacionadas con entrenamiento
const popularTags = todasLasEtiquetas
  .filter(tag => {
    const relatedCategories = tag.data.categories || [];
    return relatedCategories.includes('entrenamiento');
  })
  .map(tag => tag.data.name);

// SubcategorÃ­as dinÃ¡micas basadas en etiquetas
const subcategories = todasLasEtiquetas
  .filter(tag => {
    const relatedCategories = tag.data.categories || [];
    return relatedCategories.includes('entrenamiento');
  })
  .map(tag => tag.data.name);

const title = categoriaEntrenamiento?.data.name || "Entrenamiento de Mascotas";
const description = categoriaEntrenamiento?.data.description || "Descubre tÃ©cnicas efectivas y consejos de expertos para entrenar a tu perro o gato. GuÃ­as paso a paso para todos los niveles.";
const image = categoriaEntrenamiento?.data.image || "/images/categories/training-banner.jpg";
---

<CategoryLayout
  title={title}
  description={description}
  image={image}
  category="entrenamiento"
  subcategories={subcategories}
  articles={articles}
  popularTags={popularTags}
  featuredArticle={featuredArticle}
/>