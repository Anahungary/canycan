---
// src/pages/blog/tag/[tag].astro - Página dinámica para etiquetas del blog
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Container from '../../../components/ui/Container.astro';
import ArticleList from '../../../components/blog/ArticleList.astro';
import Button from '../../../components/ui/Button.astro';
import Badge from '../../../components/ui/Badge.astro';
import Card from '../../../components/ui/Card.astro';

// En un entorno real, esto sería una consulta a la API o CMS
export async function getStaticPaths() {
  // Definir las etiquetas disponibles
  const tags = [
    { slug: 'cachorros', name: 'Cachorros' },
    { slug: 'adiestramiento', name: 'Adiestramiento' },
    { slug: 'nutricion', name: 'Nutrición' },
    { slug: 'salud-dental', name: 'Salud dental' },
    { slug: 'comportamiento', name: 'Comportamiento' },
    { slug: 'socializacion', name: 'Socialización' },
    { slug: 'juegos', name: 'Juegos' },
    { slug: 'adopcion', name: 'Adopción' }
  ];
  
  // Base de datos simulada de artículos con etiquetas
  const allArticles = [
    {
      id: 'primeros-dias-cachorro',
      title: 'La guía definitiva para los primeros días con tu cachorro',
      excerpt: 'Todo lo que necesitas saber para que la adaptación de tu nuevo cachorro al hogar sea exitosa y sin estrés.',
      image: '/images/articles/puppy-first-days.jpg',
      date: '2023-09-05',
      author: {
        name: 'Laura Martín',
        avatar: '/images/authors/laura-martin.jpg'
      },
      readingTime: 10,
      categories: ['nuevos-duenos', 'perros'],
      tags: ['cachorros', 'socializacion', 'adopcion']
    },
    {
      id: 'comandos-basicos-perros',
      title: 'Los 5 comandos básicos que todo perro debería conocer',
      excerpt: 'Guía paso a paso para enseñar a tu perro los comandos fundamentales: sentado, quieto, ven, abajo y junto.',
      image: '/images/articles/basic-commands.jpg',
      date: '2023-09-20',
      author: {
        name: 'Carlos Ruiz',
        avatar: '/images/authors/carlos-ruiz.jpg'
      },
      readingTime: 7,
      categories: ['entrenamiento', 'perros'],
      tags: ['adiestramiento', 'comportamiento']
    },
    {
      id: 'como-elegir-comida-perro',
      title: 'Cómo elegir la alimentación ideal para tu perro',
      excerpt: 'Guía completa para entender las necesidades nutricionales de tu perro según su edad, tamaño y actividad física.',
      image: '/images/articles/dog-food-guide.jpg',
      date: '2023-09-15',
      author: {
        name: 'María Gómez',
        avatar: '/images/authors/maria-gomez.jpg'
      },
      readingTime: 8,
      categories: ['alimentacion', 'perros'],
      tags: ['nutricion', 'cachorros']
    },
    {
      id: 'juguetes-inteligencia-perros',
      title: '7 juguetes para estimular la inteligencia de tu perro',
      excerpt: 'Descubre los mejores juguetes interactivos para mantener a tu perro mental y físicamente activo.',
      image: '/images/articles/dog-toys.jpg',
      date: '2023-09-03',
      author: {
        name: 'Carlos Ruiz',
        avatar: '/images/authors/carlos-ruiz.jpg'
      },
      readingTime: 5,
      categories: ['entretenimiento', 'perros'],
      tags: ['juegos', 'comportamiento']
    },
    {
      id: 'limpieza-dental-gatos',
      title: 'Guía completa para la limpieza dental de tu gato',
      excerpt: 'Técnicas, productos y consejos para mantener una buena higiene dental en tus felinos y prevenir problemas bucales.',
      image: '/images/articles/cat-dental.jpg',
      date: '2023-08-28',
      author: {
        name: 'María Gómez',
        avatar: '/images/authors/maria-gomez.jpg'
      },
      readingTime: 6,
      categories: ['salud', 'gatos'],
      tags: ['salud-dental']
    },
    {
      id: 'proceso-adopcion-perro',
      title: 'Paso a paso: El proceso de adopción de un perro en protectoras',
      excerpt: 'Todo lo que debes saber antes, durante y después de adoptar un perro: trámites, visitas y preparación del hogar.',
      image: '/images/articles/dog-adoption.jpg',
      date: '2023-08-25',
      author: {
        name: 'Laura Martín',
        avatar: '/images/authors/laura-martin.jpg'
      },
      readingTime: 9,
      categories: ['adopcion', 'perros'],
      tags: ['adopcion', 'socializacion']
    }
  ];
  
  return tags.map(tag => {
    // Filtrar artículos por etiqueta
    const tagArticles = allArticles.filter(article => 
      article.tags && article.tags.includes(tag.slug)
    );
    
    return {
      params: { tag: tag.slug },
      props: { 
        tag,
        articles: tagArticles
      }
    };
  });
}

const { tag, articles } = Astro.props;

// Etiquetas populares (simulación)
const popularTags = [
  { slug: 'cachorros', name: 'Cachorros' },
  { slug: 'adiestramiento', name: 'Adiestramiento' },
  { slug: 'nutricion', name: 'Nutrición' },
  { slug: 'salud-dental', name: 'Salud dental' },
  { slug: 'comportamiento', name: 'Comportamiento' },
  { slug: 'socializacion', name: 'Socialización' },
  { slug: 'juegos', name: 'Juegos' },
  { slug: 'adopcion', name: 'Adopción' }
];
---

<BaseLayout
  title={`${tag.name} | Artículos sobre ${tag.name.toLowerCase()}`}
  description={`Encuentra los mejores artículos, consejos y guías sobre ${tag.name.toLowerCase()} para perros y gatos en nuestra revista digital especializada.`}
>
  {/* Hero de etiqueta */}
  <div class="bg-[#f3f3f3] bg-opacity-20">
    <Container>
      <div class="py-12 md:py-16">
        <div class="max-w-3xl">
          <Badge variant="primary" size="md" class="mb-3">Etiqueta</Badge>
          <h1 class="text-3xl md:text-4xl font-bold text-[#2E2E2E] mb-4">{tag.name}</h1>
          <p class="text-lg text-gray-600">
            Artículos etiquetados con <span class="font-medium">{tag.name}</span> - encuentra la mejor información sobre este tema.
          </p>
          
          {/* Breadcrumbs */}
          <div class="flex items-center text-sm text-gray-500 mt-4">
            <a href="/" class="hover:text-[#AFC2D5]">Inicio</a>
            <span class="mx-2">/</span>
            <a href="/blog" class="hover:text-[#AFC2D5]">Blog</a>
            <span class="mx-2">/</span>
            <span class="text-gray-700">{tag.name}</span>
          </div>
        </div>
      </div>
    </Container>
  </div>
  
  <Container class="py-12">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      {/* Artículos */}
      <div class="lg:col-span-8">
        {articles.length > 0 ? (
          <div>
            <ArticleList 
              articles={articles} 
              layout="grid" 
              columns={2}
            />
            
            {/* Paginación (si hubiera) */}
            {articles.length > 6 && (
              <div class="mt-10 flex justify-center">
                <nav class="flex items-center">
                  <span class="px-4 py-2 mx-1 bg-[#AFC2D5] text-white rounded-md text-sm">1</span>
                  <a 
                    href={`/blog/tag/${tag.slug}/page/2`}
                    class="px-4 py-2 mx-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50"
                  >
                    2
                  </a>
                  <a 
                    href={`/blog/tag/${tag.slug}/page/2`}
                    class="px-4 py-2 mx-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50"
                  >
                    Siguiente &raquo;
                  </a>
                </nav>
              </div>
            )}
          </div>
        ) : (
          <div class="bg-gray-50 rounded-lg p-8 text-center">
            <h2 class="text-lg font-medium text-gray-900 mb-2">No se encontraron artículos</h2>
            <p class="text-gray-600 mb-4">
              Aún no tenemos artículos con esta etiqueta. ¡Vuelve pronto!
            </p>
            <Button href="/blog" variant="primary">
              Volver al blog
            </Button>
          </div>
        )}
      </div>
      
      {/* Sidebar */}
      <div class="lg:col-span-4">
        <div class="sticky top-[140px] space-y-8">
          {/* Etiquetas populares */}
          <Card variant="default" padding="md">
            <h3 class="text-lg font-bold mb-4">Etiquetas populares</h3>
            <div class="flex flex-wrap gap-2">
              {popularTags.map(popularTag => (
                <a 
                  href={`/blog/tag/${popularTag.slug}`}
                  class={`px-3 py-1 rounded-full text-sm ${
                    popularTag.slug === tag.slug 
                      ? 'bg-[#AFC2D5] text-white' 
                      : 'bg-gray-100 hover:bg-gray-200 text-gray-800'
                  }`}
                >
                  {popularTag.name}
                </a>
              ))}
            </div>
          </Card>
          
          {/* Artículos relacionados */}
          {articles.length > 0 && (
            <Card variant="default" padding="md">
              <h3 class="text-lg font-bold mb-4">Quizás te interese</h3>
              <div class="space-y-4">
                {articles.slice(0, 3).map(article => (
                  <a href={`/articulos/${article.id}`} class="flex group">
                    <div class="flex-shrink-0 w-16 h-16 rounded-md overflow-hidden">
                      <img 
                        src={article.image} 
                        alt={article.title}
                        class="w-full h-full object-cover"
                      />
                    </div>
                    <div class="ml-3">
                      <h4 class="text-sm font-medium group-hover:text-[#AFC2D5] transition-colors duration-200">
                        {article.title}
                      </h4>
                      <p class="text-xs text-gray-500 mt-1">{article.readingTime} min lectura</p>
                    </div>
                  </a>
                ))}
              </div>
            </Card>
          )}
          
          {/* Newsletter */}
          <Card variant="highlight" padding="md">
            <h3 class="text-lg font-bold mb-3">Suscríbete a nuestra newsletter</h3>
            <p class="text-sm text-gray-600 mb-4">
              Recibe los mejores artículos directamente en tu correo.
            </p>
            
            <form class="space-y-3">
              <div>
                <label for="email-sidebar" class="sr-only">Correo electrónico</label>
                <input
                  type="email"
                  id="email-sidebar"
                  name="email"
                  required
                  placeholder="Tu correo electrónico"
                  class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#AFC2D5] focus:border-transparent"
                />
              </div>
              <div class="flex">
                <label class="flex items-start">
                  <input 
                    type="checkbox" 
                    name="accept-terms" 
                    required
                    class="h-4 w-4 mt-1 rounded border-gray-300 text-[#AFC2D5] focus:ring-[#AFC2D5]" 
                  />
                  <span class="ml-2 text-xs text-gray-500">
                    Acepto recibir correos y la política de privacidad
                  </span>
                </label>
              </div>
              <button
                type="submit"
                class="w-full bg-[#AFC2D5] hover:bg-[#9DB3C6] text-white py-2 px-4 rounded-md text-sm font-medium transition-colors duration-200"
              >
                Suscribirme
              </button>
            </form>
          </Card>
        </div>
      </div>
    </div>
  </Container>
</BaseLayout>