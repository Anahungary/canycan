---
// src/pages/razas/index.astro - VERSI√ìN FINAL SIN ERRORES
import BaseLayout from '../../layouts/BaseLayout.astro';
import Container from '../../components/ui/Container.astro';
import Button from '../../components/ui/Button.astro';
import BreedsComparisonContainer from '../../components/features/breeds-comparison/BreedsComparisonContainer.jsx';
import { breedsData } from '../../data/breeds/index.js';

const title = "Razas de Perros y Gatos | Encuentra tu compa√±ero ideal";
const description = "Explora m√°s de 50 razas de perros y gatos con informaci√≥n detallada sobre temperamento, cuidados y compatibilidad familiar.";

// ‚úÖ SOLUCI√ìN DEFINITIVA PARA ERRORES DE TIPOS
const breeds: any[] = Array.isArray(breedsData) ? breedsData : [];

// üìä Estad√≠sticas para mostrar
const stats = {
  total: breeds.length,
  dogs: breeds.filter((breed: any) => breed?.type === 'dog').length,
  cats: breeds.filter((breed: any) => breed?.type === 'cat').length,
  hypoallergenic: breeds.filter((breed: any) => breed?.hypoallergenic === true).length
};
---

<BaseLayout title={title} description={description}>
  {/* Hero Section */}
  <div class="bg-gradient-to-br from-[#FAFAFA] to-[#E6ECF2] py-16">
    <Container>
      <div class="text-center max-w-4xl mx-auto mb-12">
        <h1 class="text-3xl md:text-5xl font-bold text-[#2E2E2E] mb-4">
          Encuentra la raza perfecta para ti
        </h1>
        <p class="text-lg text-gray-600 mb-8">
          Explora caracter√≠sticas detalladas, temperamento y necesidades de cada raza para tomar la mejor decisi√≥n para tu familia.
        </p>
        
        {/* Estad√≠sticas */}
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-2xl mx-auto mb-8">
          <div class="bg-white rounded-lg p-4 shadow-sm">
            <div class="text-2xl font-bold text-green-500">{stats.total}</div>
            <div class="text-sm text-gray-600">Razas totales</div>
          </div>
          <div class="bg-white rounded-lg p-4 shadow-sm">
            <div class="text-2xl font-bold text-green-500">{stats.dogs}</div>
            <div class="text-sm text-gray-600">Perros</div>
          </div>
          <div class="bg-white rounded-lg p-4 shadow-sm">
            <div class="text-2xl font-bold text-green-500">{stats.cats}</div>
            <div class="text-sm text-gray-600">Gatos</div>
          </div>
          <div class="bg-white rounded-lg p-4 shadow-sm">
            <div class="text-2xl font-bold text-green-500">{stats.hypoallergenic}</div>
            <div class="text-sm text-gray-600">Hipoalerg√©nicas</div>
          </div>
        </div>

        {/* Botones principales */}
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button href="/tu-raza-ideal" variant="primary" size="lg" class="bg-green-500 text-white hover:bg-[#9DB3C6]">
            üéØ Descubre tu raza ideal
          </Button>
          <Button 
            href="#comparador" 
            variant="outline" 
            size="lg" 
            class="border-green-500 text-green-500 hover:bg-green-500 hover:text-white"
          >
            üîç Comparar razas
          </Button>
        </div>
      </div>
    </Container>
  </div>

  {/* Secci√≥n del Comparador */}
  <section id="comparador" class="py-12 bg-white">
    <Container>
      <div class="mb-12">
        <BreedsComparisonContainer breeds={breeds as any} client:load />
      </div>
    </Container>
  </section>

  {/* Secci√≥n informativa */}
  <section class="py-12 bg-[#FAFAFA]">
    <Container>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        {/* C√≥mo funciona el comparador */}
        <div class="bg-white rounded-xl p-6 shadow-sm">
          <h3 class="text-xl font-bold mb-4 text-[#2E2E2E]">
            üéØ C√≥mo funciona nuestro comparador inteligente
          </h3>
          <ul class="space-y-3 text-sm">
            <li class="flex items-start">
              <div class="flex-shrink-0 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white mr-3 mt-0.5">
                <span class="text-xs font-bold">1</span>
              </div>
              <p><strong>Filtra por tus necesidades:</strong> Usa los filtros para encontrar razas que se adapten a tu estilo de vida.</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white mr-3 mt-0.5">
                <span class="text-xs font-bold">2</span>
              </div>
              <p><strong>Selecciona hasta 3 razas:</strong> Haz clic en "Comparar" en las razas que te interesan.</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white mr-3 mt-0.5">
                <span class="text-xs font-bold">3</span>
              </div>
              <p><strong>An√°lisis autom√°tico:</strong> Ve comparaciones directas sin necesidad de hacer test.</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white mr-3 mt-0.5">
                <span class="text-xs font-bold">4</span>
              </div>
              <p><strong>Test opcional:</strong> Para mayor precisi√≥n, completa nuestro cuestionario.</p>
            </li>
          </ul>
        </div>

        {/* Consejos para usar el comparador */}
        <div class="bg-white rounded-xl p-6 shadow-sm">
          <h3 class="text-xl font-bold mb-4 text-[#2E2E2E]">
            üí° Consejos para encontrar tu raza ideal
          </h3>
          <ul class="space-y-3 text-sm">
            <li class="flex items-start">
              <div class="flex-shrink-0 w-6 h-6 rounded-full bg-[#facc14] flex items-center justify-center text-black mr-3 mt-0.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
              </div>
              <p><strong>Funciona sin test:</strong> El comparador muestra an√°lisis directos autom√°ticamente.</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 w-6 h-6 rounded-full bg-[#facc14] flex items-center justify-center text-black mr-3 mt-0.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
              </div>
              <p><strong>Usa m√∫ltiples filtros:</strong> Combina tipo, tama√±o, energ√≠a y compatibilidad familiar.</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 w-6 h-6 rounded-full bg-[#facc14] flex items-center justify-center text-black mr-3 mt-0.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
              </div>
              <p><strong>Compara diferentes tipos:</strong> Mezcla perros grandes y peque√±os para ver diferencias.</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 w-6 h-6 rounded-full bg-[#facc14] flex items-center justify-center text-black mr-3 mt-0.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
              </div>
              <p><strong>Test personalizado opcional:</strong> Para mayor precisi√≥n, completa "Tu Raza Ideal".</p>
            </li>
          </ul>
        </div>
      </div>
    </Container>
  </section>

  {/* Navegaci√≥n r√°pida por tipo */}
  <section class="py-8 bg-white border-t border-gray-200">
    <Container>
      <div class="text-center mb-6">
        <h3 class="text-lg font-bold text-[#2E2E2E] mb-2">Exploraci√≥n r√°pida</h3>
        <p class="text-gray-600">Acceso directo a tipos espec√≠ficos</p>
      </div>
      
      <div class="flex flex-wrap justify-center gap-4">
        <Button 
          href="#comparador" 
          variant="primary" 
          size="md" 
          class="bg-green-500 text-white hover:bg-[#9DB3C6] filter-button"
          data-filter="dog"
        >
          üêï Solo Perros ({stats.dogs})
        </Button>
        <Button 
          href="#comparador" 
          variant="primary" 
          size="md" 
          class="bg-green-500 text-white hover:bg-[#9DB3C6] filter-button"
          data-filter="cat"
        >
          üê± Solo Gatos ({stats.cats})
        </Button>
        <Button 
          href="#comparador" 
          variant="outline" 
          size="md" 
          class="border-green-500 text-green-500 hover:bg-green-500 hover:text-white filter-button"
          data-filter="hypoallergenic"
        >
          ‚ú® Hipoalerg√©nicas ({stats.hypoallergenic})
        </Button>
        <Button 
          href="#comparador" 
          variant="outline" 
          size="md" 
          class="border-green-500 text-green-500 hover:bg-green-500 hover:text-white filter-button"
          data-filter="apartment"
        >
          üè† Ideales para apartamento
        </Button>
      </div>
    </Container>
  </section>



  <style>
    /* Estilos espec√≠ficos para la integraci√≥n */
    .breeds-comparison-wrapper {
      min-height: 600px;
      border-radius: 1rem;
      overflow: hidden;
    }

    /* Scroll suave mejorado */
    html {
      scroll-behavior: smooth;
    }

    /* Animaciones para botones de filtro r√°pido */
    .filter-button {
      transition: all 0.3s ease;
    }

    .filter-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(175, 194, 213, 0.3);
    }

    /* Mejoras responsive */
    @media (max-width: 768px) {
      .breeds-comparison-wrapper {
        margin: 0 -1rem;
        border-radius: 0;
      }
    }

    /* Loading states */
    .breeds-comparison-wrapper .animate-spin {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>

  <!-- Script simplificado y movido a archivo externo para evitar errores TS -->
  <script is:inline>
    document.addEventListener('DOMContentLoaded', function() {
      // Scroll suave para enlaces internos
      const anchorLinks = document.querySelectorAll('a[href^="#"]');
      anchorLinks.forEach(function(anchor) {
        anchor.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = anchor.getAttribute('href');
          if (targetId && targetId !== '#') {
            const target = document.querySelector(targetId);
            if (target) {
              target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }
        });
      });

      // Manejador para botones de filtro r√°pido - CSS puro
      const filterButtons = document.querySelectorAll('.filter-button');
      filterButtons.forEach(function(button) {
        button.addEventListener('click', function(e) {
          const filterType = button.getAttribute('data-filter');
          
          // Scroll al comparador
          const comparador = document.querySelector('#comparador');
          if (comparador) {
            comparador.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'start' 
            });
            
            // Disparar evento para React despu√©s del scroll
            setTimeout(function() {
              const event = new CustomEvent('quickFilterApplied', {
                detail: { filterType: filterType }
              });
              document.dispatchEvent(event);
            }, 800);
          }
        });
      });

      // Detectar si viene de URL con hash
      if (window.location.hash === '#comparador') {
        setTimeout(function() {
          const comparador = document.querySelector('#comparador');
          if (comparador) {
            comparador.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'start' 
            });
          }
        }, 100);
      }
    });
  </script>
</BaseLayout>